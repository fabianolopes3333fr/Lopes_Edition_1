{% extends 'base_dashboard.html' %}
{% load static %}

{% block title %}Mes Projets - LOPES PEINTURE{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header -->
    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
        <div>
            <h1 class="text-4xl font-bold text-gray-900 flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-paint-brush text-white text-xl"></i>
                </div>
                Mes Projets
            </h1>
            <p class="text-gray-600 mt-2 text-lg">
                Gérez vos projets de peinture et rénovation
            </p>
        </div>

        <a href="{% url 'orcamentos:cliente_criar_projeto' %}"
           class="px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl font-semibold shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105 flex items-center gap-3">
            <i class="fas fa-plus"></i>
            Nouveau Projet
        </a>
    </div>

    <!-- Filtros -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
        <form method="get" class="flex flex-wrap items-center gap-4">
            <div class="flex items-center gap-3">
                <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
                    <i class="fas fa-filter text-blue-600"></i>
                    Statut:
                </label>
                <select name="status" class="border-2 border-gray-200 rounded-xl px-4 py-2 text-sm font-medium focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-300" onchange="this.form.submit()">
                    <option value="">Tous les statuts</option>
                    {% for value, label in status_choices %}
                        <option value="{{ value }}" {% if current_status == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            {% if current_status %}
                <a href="{% url 'orcamentos:cliente_projetos' %}"
                   class="px-4 py-2 bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2">
                    <i class="fas fa-times"></i>
                    Réinitialiser filtres
                </a>
            {% endif %}
        </form>
    </div>

    <!-- Lista de Projetos -->
    {% if projetos %}
        <div class="grid grid-cols-1 gap-8">
            {% for projeto in projetos %}
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 overflow-hidden">
                    <div class="p-8">
                        <div class="flex flex-col lg:flex-row justify-between items-start gap-6">
                            <div class="flex-1">
                                <h3 class="text-2xl font-bold text-gray-900 mb-4">
                                    <a href="{% url 'orcamentos:cliente_projeto_detail' projeto.uuid %}"
                                       class="hover:text-blue-600 transition-colors duration-200 flex items-center gap-3">
                                        <i class="fas fa-folder-open text-blue-600"></i>
                                        {{ projeto.titulo }}
                                    </a>
                                </h3>

                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                    <div class="flex items-center gap-2 text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg">
                                        <i class="fas fa-tag text-blue-600"></i>
                                        <span class="font-medium">{{ projeto.get_tipo_servico_display }}</span>
                                    </div>

                                    <div class="flex items-center gap-2 text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg">
                                        <i class="fas fa-map-marker-alt text-green-600"></i>
                                        <span class="font-medium">{{ projeto.cidade_projeto }}</span>
                                    </div>

                                    {% if projeto.area_aproximada %}
                                    <div class="flex items-center gap-2 text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg">
                                        <i class="fas fa-ruler-combined text-purple-600"></i>
                                        <span class="font-medium">{{ projeto.area_aproximada }} m²</span>
                                    </div>
                                    {% endif %}

                                    <div class="flex items-center gap-2 text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-lg">
                                        <i class="fas fa-calendar text-orange-600"></i>
                                        <span class="font-medium">{{ projeto.created_at|date:"d/m/Y" }}</span>
                                    </div>
                                </div>

                                <p class="text-gray-700 leading-relaxed mb-6">
                                    {{ projeto.descricao|truncatewords:25 }}
                                </p>
                            </div>

                            <div class="flex flex-col items-end gap-4 min-w-[200px]">
                                <!-- Status Badge -->
                                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold shadow-md
                                    {% if projeto.status == 'planejando' %}bg-gradient-to-r from-yellow-100 to-yellow-200 text-yellow-800
                                    {% elif projeto.status == 'em_andamento' %}bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800
                                    {% elif projeto.status == 'concluido' %}bg-gradient-to-r from-green-100 to-green-200 text-green-800
                                    {% elif projeto.status == 'pausado' %}bg-gradient-to-r from-gray-100 to-gray-200 text-gray-800
                                    {% else %}bg-gradient-to-r from-red-100 to-red-200 text-red-800{% endif %}">
                                    {{ projeto.get_status_display }}
                                </span>

                                <!-- Urgência -->
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold
                                    {% if projeto.urgencia == 'baixa' %}bg-green-100 text-green-700
                                    {% elif projeto.urgencia == 'media' %}bg-blue-100 text-blue-700
                                    {% elif projeto.urgencia == 'alta' %}bg-orange-100 text-orange-700
                                    {% else %}bg-red-100 text-red-700{% endif %}">
                                    {{ projeto.get_urgencia_display }}
                                </span>

                                {% if projeto.orcamento_estimado %}
                                <div class="text-right">
                                    <div class="text-sm text-gray-600">Budget estimé</div>
                                    <div class="text-xl font-bold text-blue-600">€{{ projeto.orcamento_estimado }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Actions e informações -->
                        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center pt-6 border-t border-gray-200 gap-4">
                            <div class="flex items-center gap-6 text-sm text-gray-600">
                                <!-- Número de solicitações de orçamento -->
                                <div class="flex items-center gap-2 bg-blue-50 px-3 py-2 rounded-lg">
                                    <i class="fas fa-file-invoice-dollar text-blue-600"></i>
                                    <span class="font-medium">{{ projeto.solicitacoes_orcamento.count }} devis demandé{{ projeto.solicitacoes_orcamento.count|pluralize }}</span>
                                </div>

                                <!-- Anexos -->
                                {% if projeto.anexos.count %}
                                <div class="flex items-center gap-2 bg-purple-50 px-3 py-2 rounded-lg">
                                    <i class="fas fa-paperclip text-purple-600"></i>
                                    <span class="font-medium">{{ projeto.anexos.count }} fichier{{ projeto.anexos.count|pluralize }}</span>
                                </div>
                                {% endif %}
                            </div>

                            <div class="flex items-center gap-3">
                                <a href="{% url 'orcamentos:cliente_projeto_detail' projeto.uuid %}"
                                   class="px-6 py-2 border-2 border-blue-600 text-blue-600 hover:bg-blue-50 rounded-lg font-semibold transition-all duration-200 flex items-center gap-2">
                                    <i class="fas fa-eye"></i>
                                    Voir détails
                                </a>

                                <a href="{% url 'orcamentos:cliente_solicitar_orcamento' projeto.uuid %}"
                                   class="px-6 py-2 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                                    <i class="fas fa-file-invoice-dollar"></i>
                                    Demander devis
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Paginação -->
        {% if projetos.has_other_pages %}
            <div class="flex justify-center mt-12">
                <nav class="flex items-center gap-2">
                    {% if projetos.has_previous %}
                        <a href="?page={{ projetos.previous_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}"
                           class="px-4 py-2 bg-white border-2 border-gray-300 text-gray-600 hover:text-blue-600 hover:border-blue-300 rounded-lg transition-all duration-200 flex items-center gap-2">
                            <i class="fas fa-chevron-left"></i> Précédent
                        </a>
                    {% endif %}

                    <span class="px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold">
                        Page {{ projetos.number }} sur {{ projetos.paginator.num_pages }}
                    </span>

                    {% if projetos.has_next %}
                        <a href="?page={{ projetos.next_page_number }}{% if current_status %}&status={{ current_status }}{% endif %}"
                           class="px-4 py-2 bg-white border-2 border-gray-300 text-gray-600 hover:text-blue-600 hover:border-blue-300 rounded-lg transition-all duration-200 flex items-center gap-2">
                            Suivant <i class="fas fa-chevron-right"></i>
                        </a>
                    {% endif %}
                </nav>
            </div>
        {% endif %}

    {% else %}
        <!-- Estado vazio -->
        <div class="text-center py-16">
            <div class="w-32 h-32 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center mx-auto mb-8">
                <i class="fas fa-paint-brush text-blue-600 text-4xl"></i>
            </div>

            <h3 class="text-2xl font-bold text-gray-900 mb-4">
                Aucun projet pour le moment
            </h3>

            <p class="text-gray-600 mb-8 max-w-md mx-auto leading-relaxed">
                Créez votre premier projet pour organiser vos travaux de peinture et demander des devis personnalisés.
            </p>

            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="{% url 'orcamentos:cliente_criar_projeto' %}"
                   class="px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl font-semibold shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-3">
                    <i class="fas fa-plus"></i>
                    Créer mon premier projet
                </a>

                <a href="{% url 'orcamentos:solicitar_publico' %}"
                   class="px-8 py-4 border-2 border-gray-300 hover:border-blue-500 text-gray-700 hover:text-blue-600 rounded-xl font-semibold transition-all duration-300 hover:bg-blue-50 flex items-center justify-center gap-3">
                    <i class="fas fa-file-invoice-dollar"></i>
                    Demander un devis direct
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add any client projects specific JavaScript here
    console.log('Client projects page loaded');
});
</script>
{% endblock %}
