<!-- Newsletter Section -->
<section
  class="newsletter-section py-20 lg:py-32 bg-gradient-to-br from-primary-600 via-primary-700 to-primary-800 relative overflow-hidden"
>
  <!-- Background Elements -->
  <div class="absolute inset-0 opacity-10">
    <div class="absolute top-10 left-10 w-32 h-32 bg-white rounded-full animate-float"></div>
    <div
      class="absolute top-1/2 right-20 w-24 h-24 bg-white rounded-full animate-float"
      style="animation-delay: 1s"
    ></div>
    <div
      class="absolute bottom-20 left-1/3 w-20 h-20 bg-white rounded-full animate-float"
      style="animation-delay: 2s"
    ></div>
    <div
      class="absolute top-1/4 left-1/2 w-16 h-16 bg-white rounded-full animate-float"
      style="animation-delay: 0.5s"
    ></div>
  </div>

  <!-- Decorative Pattern -->
  <div class="absolute inset-0 opacity-5">
    <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
      <defs>
        <pattern
          id="newsletter-pattern"
          x="0"
          y="0"
          width="20"
          height="20"
          patternUnits="userSpaceOnUse"
        >
        
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#newsletter-pattern)" />
    </svg>
  </div>

  <div class="container mx-auto px-4 relative z-10">
    <!-- Section Header -->
    <div class="text-center mb-16 animate-fade-in-up">
      <div
        class="inline-flex items-center justify-center w-16 h-16 bg-white bg-opacity-20 rounded-full mb-6"
      >
        <i class="fas fa-envelope text-2xl text-white"></i>
      </div>

      <h2 class="text-4xl lg:text-5xl font-bold text-white mb-6">
        Restez informé de nos actualités
      </h2>

      <p class="text-xl text-blue-100 max-w-3xl mx-auto leading-relaxed">
        Recevez nos conseils d'experts, nos dernières réalisations et nos offres exclusives
        directement dans votre boîte mail
      </p>
    </div>

    <!-- Newsletter Form -->
    <div class="max-w-4xl mx-auto animate-fade-in-up" style="animation-delay: 0.2s">
      <div
        class="bg-white bg-opacity-10 backdrop-blur-lg rounded-3xl p-8 lg:p-12 border border-white border-opacity-20 shadow-2xl"
      >
        <form id="newsletter-form" class="space-y-6" method="POST" action="{% url 'blog:newsletter_subscribe' %}">
          {% csrf_token %}

          <!-- Form Grid -->
          <div class="grid md:grid-cols-2 gap-6">
            <!-- Prénom -->
            <div class="form-group">
              <label for="prenom" class="block text-white font-medium mb-2">
                <i class="fas fa-user mr-2"></i>Prénom
              </label>
              <input
                type="text"
                id="prenom"
                name="prenom"
                required
                class="w-full px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-xl text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-white focus:border-transparent transition-all duration-300"
                placeholder="Votre prénom"
              />
            </div>

            <!-- Email -->
            <div class="form-group">
              <label for="email" class="block text-white font-medium mb-2">
                <i class="fas fa-envelope mr-2"></i>Email *
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-xl text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-white focus:border-transparent transition-all duration-300"
                placeholder="votre@email.com"
              />
            </div>
          </div>

          <!-- Interests -->
          <div class="form-group">
            <label class="block text-white font-medium mb-4">
              <i class="fas fa-heart mr-2"></i>Vos centres d'intérêt (optionnel)
            </label>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
              <label class="flex items-center cursor-pointer group">
                <input
                  type="checkbox"
                  name="interests"
                  value="peinture_interieur"
                  class="sr-only"
                />
                <div
                  class="interest-checkbox flex items-center justify-center w-full py-3 px-4 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-xl text-white text-sm font-medium transition-all duration-300 group-hover:bg-opacity-20"
                >
                  <i class="fas fa-home mr-2"></i>Intérieur
                </div>
              </label>

              <label class="flex items-center cursor-pointer group">
                <input
                  type="checkbox"
                  name="interests"
                  value="peinture_exterieur"
                  class="sr-only"
                />
                <div
                  class="interest-checkbox flex items-center justify-center w-full py-3 px-4 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-xl text-white text-sm font-medium transition-all duration-300 group-hover:bg-opacity-20"
                >
                  <i class="fas fa-tree mr-2"></i>Extérieur
                </div>
              </label>

              <label class="flex items-center cursor-pointer group">
                <input type="checkbox" name="interests" value="decoration" class="sr-only" />
                <div
                  class="interest-checkbox flex items-center justify-center w-full py-3 px-4 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-xl text-white text-sm font-medium transition-all duration-300 group-hover:bg-opacity-20"
                >
                  <i class="fas fa-palette mr-2"></i>Décoration
                </div>
              </label>

              <label class="flex items-center cursor-pointer group">
                <input type="checkbox" name="interests" value="conseils" class="sr-only" />
                <div
                  class="interest-checkbox flex items-center justify-center w-full py-3 px-4 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-xl text-white text-sm font-medium transition-all duration-300 group-hover:bg-opacity-20"
                >
                  <i class="fas fa-lightbulb mr-2"></i>Conseils
                </div>
              </label>
            </div>
          </div>

          <!-- RGPD Consent -->
          <div class="form-group">
            <label class="flex items-start cursor-pointer group">
              <input
                type="checkbox"
                name="rgpd_consent"
                required
                class="mt-1 mr-3 w-5 h-5 text-white bg-white bg-opacity-20 border border-white border-opacity-30 rounded focus:ring-2 focus:ring-white"
              />
              <span class="text-sm text-blue-100 leading-relaxed">
                J'accepte de recevoir des emails de Lopes Peinture et je consens au traitement de
                mes données personnelles conformément à la
                <a
                  href="/politique-confidentialite/"
                  class="text-white underline hover:no-underline"
                  target="_blank"
                  >politique de confidentialité</a
                >. *
              </span>
            </label>
          </div>

          <!-- Submit Button -->
          <div class="text-center">
            <button
              type="submit"
              class="inline-flex items-center justify-center bg-white text-primary-600 px-8 py-4 rounded-full font-bold text-lg hover:bg-blue-50 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl min-w-[200px]"
            >
              <span class="submit-text">
                <i class="fas fa-paper-plane mr-2"></i>
                S'abonner
              </span>
              <span class="loading-text hidden">
                <i class="fas fa-spinner fa-spin mr-2"></i>
                Inscription...
              </span>
            </button>
          </div>

          <!-- Success/Error Messages -->
          <div id="form-messages" class="text-center hidden">
            <div
              id="success-message"
              class="bg-green-500 bg-opacity-20 border border-green-400 text-green-100 px-6 py-4 rounded-xl hidden"
            >
              <i class="fas fa-check-circle mr-2"></i>
              Merci ! Votre inscription a été confirmée. Vérifiez votre email.
            </div>
            <div
              id="error-message"
              class="bg-red-500 bg-opacity-20 border border-red-400 text-red-100 px-6 py-4 rounded-xl hidden"
            >
              <i class="fas fa-exclamation-triangle mr-2"></i>
              Une erreur s'est produite. Veuillez réessayer.
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Benefits -->
    <div class="grid md:grid-cols-3 gap-8 mt-16 animate-fade-in-up" style="animation-delay: 0.4s">
      <!-- Benefit 1 -->
      <div class="text-center">
        <div
          class="inline-flex items-center justify-center w-16 h-16 bg-white bg-opacity-20 rounded-full mb-4"
        >
          <i class="fas fa-gift text-2xl text-white"></i>
        </div>
        <h3 class="text-xl font-semibold text-white mb-2">Offres Exclusives</h3>
        <p class="text-blue-100">
          Accédez en avant-première à nos promotions et tarifs préférentiels
        </p>
      </div>

      <!-- Benefit 2 -->
      <div class="text-center">
        <div
          class="inline-flex items-center justify-center w-16 h-16 bg-white bg-opacity-20 rounded-full mb-4"
        >
          <i class="fas fa-lightbulb text-2xl text-white"></i>
        </div>
        <h3 class="text-xl font-semibold text-white mb-2">Conseils d'Experts</h3>
        <p class="text-blue-100">
          Recevez nos astuces et guides pour vos projets de peinture et décoration
        </p>
      </div>

      <!-- Benefit 3 -->
      <div class="text-center">
        <div
          class="inline-flex items-center justify-center w-16 h-16 bg-white bg-opacity-20 rounded-full mb-4"
        >
          <i class="fas fa-camera text-2xl text-white"></i>
        </div>
        <h3 class="text-xl font-semibold text-white mb-2">Nos Réalisations</h3>
        <p class="text-blue-100">
          Découvrez nos derniers projets et inspirez-vous pour vos futurs travaux
        </p>
      </div>
    </div>

    <!-- Trust Indicators -->
    <div
      class="flex flex-wrap justify-center items-center gap-8 mt-16 pt-8 border-t border-white border-opacity-20 animate-fade-in-up"
      style="animation-delay: 0.6s"
    >
      <div class="flex items-center text-blue-100">
        <i class="fas fa-shield-alt text-xl mr-2"></i>
        <span class="text-sm">Données sécurisées</span>
      </div>

      <div class="flex items-center text-blue-100">
        <i class="fas fa-times-circle text-xl mr-2"></i>
        <span class="text-sm">Désabonnement facile</span>
      </div>

      <div class="flex items-center text-blue-100">
        <i class="fas fa-envelope-open text-xl mr-2"></i>
        <span class="text-sm">1 email par semaine max</span>
      </div>

      <div class="flex items-center text-blue-100">
        <i class="fas fa-heart text-xl mr-2"></i>
        <span class="text-sm">+2000 abonnés satisfaits</span>
      </div>
    </div>
  </div>
</section>

<!-- Newsletter Styles -->
<style>
  /* Float animation for background elements */
  @keyframes float {
    0%,
    100% {
      transform: translateY(0px) rotate(0deg);
    }
    25% {
      transform: translateY(-10px) rotate(1deg);
    }
    50% {
      transform: translateY(-20px) rotate(0deg);
    }
    75% {
      transform: translateY(-10px) rotate(-1deg);
    }
  }

  .animate-float {
    animation: float 6s ease-in-out infinite;
  }

  /* Form enhancements */
  .newsletter-section input:focus,
  .newsletter-section input:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5);
  }

  .newsletter-section .interest-checkbox {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .newsletter-section .interest-checkbox:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1);
  }

  /* Button hover effects */
  .newsletter-section button:hover {
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .newsletter-section .grid-cols-2 {
      grid-template-columns: 1fr;
    }

    .newsletter-section .md\:grid-cols-4 {
      grid-template-columns: repeat(2, 1fr);
    }

    .newsletter-section .text-4xl {
      font-size: 2.5rem;
    }

    .newsletter-section .lg\:text-5xl {
      font-size: 3rem;
    }
  }

  /* Accessibility improvements */
  @media (prefers-reduced-motion: reduce) {
    .animate-float,
    .animate-fade-in-up {
      animation: none;
    }

    .newsletter-section * {
      transition: none;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .newsletter-section .bg-opacity-10,
    .newsletter-section .bg-opacity-20 {
      background-color: rgba(255, 255, 255, 0.9);
      color: #1e40af;
    }

    .newsletter-section .border-opacity-20,
    .newsletter-section .border-opacity-30 {
      border-color: rgba(255, 255, 255, 1);
    }
  }
</style>
<!-- Newsletter JavaScript -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('newsletter-form');
    const submitButton = form.querySelector('button[type="submit"]');
    const submitText = submitButton.querySelector('.submit-text');
    const loadingText = submitButton.querySelector('.loading-text');
    const formMessages = document.getElementById('form-messages');
    const successMessage = document.getElementById('success-message');
    const errorMessage = document.getElementById('error-message');

    // Interest checkboxes functionality
    const interestCheckboxes = document.querySelectorAll('input[name="interests"]');
    interestCheckboxes.forEach((checkbox) => {
      checkbox.addEventListener('change', function () {
        const checkboxDiv = this.nextElementSibling;
        if (this.checked) {
          checkboxDiv.classList.add('bg-white', 'bg-opacity-30', 'border-white');
          checkboxDiv.classList.remove('bg-opacity-10', 'border-opacity-30');
        } else {
          checkboxDiv.classList.remove('bg-white', 'bg-opacity-30', 'border-white');
          checkboxDiv.classList.add('bg-opacity-10', 'border-opacity-30');
        }
      });
    });

    // Form submission
    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      // Show loading state
      submitButton.disabled = true;
      submitText.classList.add('hidden');
      loadingText.classList.remove('hidden');

      // Hide previous messages
      formMessages.classList.add('hidden');
      successMessage.classList.add('hidden');
      errorMessage.classList.add('hidden');

      try {
        const formData = new FormData(form);

        // Collect selected interests
        const selectedInterests = [];
        interestCheckboxes.forEach((checkbox) => {
          if (checkbox.checked) {
            selectedInterests.push(checkbox.value);
          }
        });
        formData.set('interests', selectedInterests.join(','));

        const response = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
          },
        });

        const data = await response.json();

        if (response.ok && data.success) {
          // Show success message
          successMessage.classList.remove('hidden');
          formMessages.classList.remove('hidden');

          // Reset form
          form.reset();

          // Reset interest checkboxes visual state
          interestCheckboxes.forEach((checkbox) => {
            const checkboxDiv = checkbox.nextElementSibling;
            checkboxDiv.classList.remove('bg-white', 'bg-opacity-30', 'border-white');
            checkboxDiv.classList.add('bg-opacity-10', 'border-opacity-30');
          });

          // Track successful subscription
          if (typeof gtag !== 'undefined') {
            gtag('event', 'newsletter_subscribe', {
              event_category: 'engagement',
              event_label: 'newsletter',
            });
          }

          // Auto-hide success message after 5 seconds
          setTimeout(() => {
            formMessages.classList.add('hidden');
            successMessage.classList.add('hidden');
          }, 5000);
        } else {
          throw new Error(data.message || "Erreur lors de l'inscription");
        }
      } catch (error) {
        console.error('Newsletter subscription error:', error);

        // Show error message
        errorMessage.querySelector('span:last-child').textContent =
          error.message || "Une erreur s'est produite. Veuillez réessayer.";
        errorMessage.classList.remove('hidden');
        formMessages.classList.remove('hidden');

        // Auto-hide error message after 5 seconds
        setTimeout(() => {
          formMessages.classList.add('hidden');
          errorMessage.classList.add('hidden');
        }, 5000);
      } finally {
        // Reset button state
        submitButton.disabled = false;
        submitText.classList.remove('hidden');
        loadingText.classList.add('hidden');
      }
    });

    // Email validation enhancement
    const emailInput = document.getElementById('email');
    emailInput.addEventListener('blur', function () {
      const email = this.value.trim();
      if (email && !isValidEmail(email)) {
        this.classList.add('border-red-400');
        this.classList.remove('border-white', 'border-opacity-30');
      } else {
        this.classList.remove('border-red-400');
        this.classList.add('border-white', 'border-opacity-30');
      }
    });

    function isValidEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    // Floating animation for background elements
    const floatingElements = document.querySelectorAll('.animate-float');
    floatingElements.forEach((element, index) => {
      element.style.animation = `float 6s ease-in-out infinite`;
      element.style.animationDelay = `${index * 0.5}s`;
    });

    // Intersection Observer for animations
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px',
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.style.animationPlayState = 'running';
        }
      });
    }, observerOptions);

    // Observe all animated elements
    document.querySelectorAll('.animate-fade-in-up').forEach((el) => {
      el.style.animationPlayState = 'paused';
      observer.observe(el);
    });
  });
</script>

